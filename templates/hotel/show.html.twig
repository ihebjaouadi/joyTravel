{% extends 'base.html.twig' %}

{% block title %}Hotel{% endblock %}

{% block body %}


<!-- breadcrumb start -->
<div class="breadcrumb-area bg-overlay-2" style="background-image:url('assets/img/other/7.png')">
    <div class="container">
        <div class="breadcrumb-inner">
            <div class="section-title text-center">
                <h2 class="page-title">Property Details</h2>
                <ul class="page-list">
                    <li><a href="index.html">Home</a></li>
                    <li>Property Details</li>
                </ul>
            </div>
        </div>
    </div>
</div>
<!-- breadcrumb end -->

<!-- property-page- Start -->
<div class="property-page-area pd-top-120 pd-bottom-90">
    <div class="container">
        <div class="property-details-top pd-bottom-70">
            <div class="property-details-top-inner">
                <div class="row">
                    <div class="col-lg-7">
                        <h3>{{ hotel.nom }}</h3>
                        <p><img src="{{ asset('assets/img/icon/location2.png') }}" alt="img">
                            {{ hotel.adresse }}, {{ hotel.complementAdresse }}, {{ hotel.codePostal }}
                            , {{ hotel.ville }}, {{ hotel.pays }}</p>

                    </div>


                </div>
            </div>
            <div class="product-thumbnail-wrapper">
                <div class="single-thumbnail-slider">
                    {% for image in hotel.images %}
                        <div class="slider-item">
                            <img style="height: 600px" src="{{ asset('uploads/images/'~ image.chemain) }}"
                                 alt="img">
                        </div>
                    {% endfor %}
                </div>
                <div class="product-thumbnail-carousel">
                    {% for image in hotel.images %}
                        <div class="single-thumbnail-item">
                            <img style="height: 100px" src="{{ asset('uploads/images/'~ image.chemain) }}"
                                 alt="img">
                        </div>
                    {% endfor %}

                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-8">
                <div class="single-property-details-inner">
                    <h4></h4>
                    <p>{{ hotel.description }}</p>
                    <div class="single-property-grid">
                        <h4>Equipement</h4>
                        <div class="row">
                            <div class="col-md-4">
                                <ul>
                                    {% for equipement in hotel.equipements %}
                                        <li>{{ equipement.nom }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>


                    <div class="single-property-grid">
                        <h4> Localisation</h4>
                        <div class="property-map">
                            <div id="map" style="height: 400px;width: 100%">

                            </div>
                        </div>


                        <div class="single-property-grid">
                            <h4>Video</h4>
                            <div class="property-video text-center"
                                 style="background: url(assets/img/project-single/8.png);">
                                <a class="play-btn" href="https://www.youtube.com/embed/Wimkqo8gDZ0"
                                   data-effect="mfp-zoom-in"><i class="fa fa-play" aria-hidden="true"></i></a>
                            </div>
                        </div>

                        <div class="single-property-grid">
                            <h4>Commentaires</h4>
                            {% if commentaires | length >  0 %}
                                {% for commentaire in commentaires %}
                                    <div  class="media single-review-inner" style="height: 128px;width: 562px;box-shadow: 12px 12px 12px 12px rgba(236, 240, 241);, 1">
                                        <div class="media-left">
                                            <div class="thumb">
                                                <img  style="height: 125px;" src="https://cdn4.vectorstock.com/i/thumb-large/93/48/customer-support-or-service-agent-vector-26289348.jpg"
                                                      alt="img">
                                            </div>
                                        </div>

                                        <div class="media-body align-self-center">
                                            <div class="row">
                                                <div class="col-md-7">
                                                    <h5>{{ commentaire.iDUser.email }} </h5>
                                                    <small>(publié
                                                        le {{ commentaire.date| date('d-m-Y H:i') }})

                                                    </small>
                                                    <p>{{ commentaire.content }}</p>
                                                </div>
                                                <div class="col-md-5 text-md-right">
                                                    {% if (app.user and app.user.email == commentaire.iDUser.email) or is_granted('ROLE_ADMIN') %}

                                                        <a data-toggle="modal" style="color: red"
                                                           data-target="#remove-{{ commentaire.id }}" class="right red"
                                                           href="#"><i class="fa fa-trash red"></i></a>



                                                        {# <a href="{{ path('commentaire_like',{'id': commentaire.id}) }}" #}
                                                        {# class="btn btn-link js-like"> #}
                                                        <div id="test"></div>

                                                        <div class="likeCommentAjax-{{ commentaire.id }}">
                                                            <form id="likeComment-{{ commentaire.id }}"
                                                                  action="{{ path('commentaire_like',{'id':commentaire.id}) }}"
                                                                  method="post">
                                                                <button type="button"
                                                                        onclick="like('{{ commentaire.id }}')"
                                                                        class="btn btn-link js-like">

                                                                    {% if app.user and commentaire.IsLikedByUser(app.user,commentaire) %}
                                                                        <i class="fas fa-thumbs-down"></i>
                                                                        <span class="js-likes">{{ commentaire.likes | length }}</span>
                                                                        <span class="js-label">je n'aime plus</span>
                                                                    {% else %}
                                                                        <i class="fas fa-thumbs-up"></i>
                                                                        <span class="js-likes">{{ commentaire.likes | length }}</span>
                                                                        <span class="js-label">j'aime</span>
                                                                    {% endif %}

                                                                </button>
                                                            </form>
                                                        </div>
                                                        {# </a> #}




                                                        <!-- Modal -->
                                                        <form action="{{ path('app_commentaire_delete',{'id':commentaire.id}) }}"
                                                              method="post">
                                                            <div id="remove-{{ commentaire.id }}" class="modal"
                                                                 role="dialog">
                                                                <div class="modal-dialog">

                                                                    <!-- Modal content-->
                                                                    <div class="modal-content">
                                                                        <div class="modal-header">
                                                                            <h4 class="modal-title">êtes-vous sûr ?</h4>
                                                                        </div>
                                                                        <div class="modal-body">
                                                                            <p style="text-align: left">{{ commentaire.content }}</p>
                                                                        </div>
                                                                        <div class="modal-footer">
                                                                            <button type="button"
                                                                                    class="btn btn-default"
                                                                                    data-dismiss="modal">NON
                                                                            </button>
                                                                            <button type="submit"
                                                                                    class="btn btn-danger">
                                                                                OUI
                                                                            </button>
                                                                        </div>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                        </form>



                                                    {% endif %}
                                                    <div class="ratting-inner" style="    font-size: 12px;">
                                                        <i class="fa fa-star" aria-hidden="true"></i>
                                                        <i class="fa fa-star" aria-hidden="true"></i>
                                                        <i class="fa fa-star" aria-hidden="true"></i>
                                                        <i class="fa fa-star" aria-hidden="true"></i>
                                                        <i class="fa fa-star" aria-hidden="true"></i>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        <hr>
                                    </div>
                                {% endfor %}
                            {% else %}
                                Aucun commentaire
                            {% endif %}
                        </div>


                        <form action="{{ path('app_hotel_show',{'id':hotel.id}) }}" method="post"
                              class="single-property-comment-form">
                            <div class="single-property-grid bg-black">
                                <div class="single-property-form-title">
                                    <div class="row">
                                        <div class="col-md-8">
                                            <h4>  {% if app.user %}
                                                    <div class="mb-3">
                                                        {{ app.user.username }} :</a>
                                                    </div>
                                                {% endif %} Pouvez-vous poster Votre commentaire sur {{ hotel.nom }} ?
                                            </h4>
                                        </div>
                                        <div class="col-md-4 text-md-right">
                                            <div class="ratting-inner">
                                                <i class="fa fa-star"></i>
                                                <i class="fa fa-star"></i>
                                                <i class="fa fa-star"></i>
                                                <i class="fa fa-star"></i>
                                                <i class="fa fa-star"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <label class="single-input-inner style-bg">
                                        <span class="label">Enter Your Messege</span>
                                        <textarea name="content" placeholder="Enter your messege here...."></textarea>
                                    </label>
                                </div>
                                <div class="col-12 mb-4">
                                    {% if app.user %}
                                        <button class="btn btn-base radius-btn" type="submit">Submit Now</button>
                                    {% else %}
                                        <a href="{{ path('app_login') }}" class="btn btn-base radius-btn">Connectez-vous
                                            pour commenter</a>

                                    {% endif %}
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="col-lg-4">
                    <aside class="sidebar-area">


                        <div class="widget widget-place">
                            <h5 class="widget-title">Complement d'adresse</h5>
                            <ul>
                                <li>{{ hotel.complementAdresse }} <span>1</span></li>
                                <li>{{ hotel.ville }} <span>2</span></li>

                            </ul>
                        </div>


                    </aside>
                </div>
            </div>
        </div>
    </div>
    <!-- property-page- end -->

    {% endblock %}
    {% block javascripts %}
        {{ parent() }}

        <script
                src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC1M9BTlyXVlMZ4Hqojzm16RJu1Bm9VEIc&callback=initMap&libraries=places&v=weekly"
                async
        ></script>
        <script>
            //https://developers.google.com/maps/documentation/javascript/examples/place-search
            let map;
            let service;
            let infowindow;

            function initMap() {
                const tunis = new google.maps.LatLng(46.232192999999995, 2.209666999999996);

                infowindow = new google.maps.InfoWindow();
                map = new google.maps.Map(document.getElementById("map"), {
                    center: tunis,
                    zoom: 12,
                });

                const request = {
                    query: "{{ hotel.getFulladress() }}",
                    fields: ["name", "geometry"], // name : adresse w geo : lat w long ...
                };

                service = new google.maps.places.PlacesService(map);
                service.findPlaceFromQuery(request, (results, status) => {
                    if (status === google.maps.places.PlacesServiceStatus.OK && results) {
                        for (let i = 0; i < results.length; i++) {
                            createMarker(results[i]);
                        }

                        map.setCenter(results[0].geometry.location);
                    }
                });
                const transitLayer = new google.maps.TransitLayer();

                transitLayer.setMap(map);
            }

            function createMarker(place) {
                if (!place.geometry || !place.geometry.location) return;

                const marker = new google.maps.Marker({
                    map,
                    position: place.geometry.location,
                    zoom: 18,  // google map develloper
                });

                google.maps.event.addListener(marker, "click", () => {
                    infowindow.setContent(place.name || "");
                    infowindow.open(map);
                });
            }
        </script>
        <script>
            function like(idcomment) {
                var action = $('#likeComment-'+idcomment).attr('action');
                $.ajax({
                    url: action,
                    type: 'POST',
                    success: function (html) {
                        $('.likeCommentAjax-'+idcomment).html(html);
                    }
                })
            }
        </script>
    {% endblock %}
